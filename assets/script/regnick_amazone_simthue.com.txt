home
define
	//screen 420dp -> 425dp
	$pk = com.amazon.mShop.android.shopping
	
	$sleep = sleep -t "random -from 1000 -to 4000"
	$scrollUp = swipe -orient up -time "random -from 250 to 1500" //time càng bé scroll càng nhanh
	$scrollDown = swipe -orient down -time 'random -from 250 to 1500' //time càng bé scroll càng nhanh
	
	$randomTukhoa = random -text "bluetooth,headphone,mouse,keyboard" -var "tukhoa"
	$getTuKhoa = 'getVar  -var "tukhoa"'
	
	$swipeLeft = 'swipe -orient left -time "random -from 300 -to 1000"'
	
	$enter = click -x 980 -y 1850
	$search = click -x 600 -y 250
	$swipeBellow = swipe -startX 700 -startY 1350 -endX "random -from 50 -to 200" -endY  "random -from 1350 -to 1550" -time "random -from 300 -to 1000"
	$clickBellow = click -x "random -from 100 -to 400" -y "random -from 1200 -to 1450"
		
		//-------------regnick-------------
	$amazon_icon = click -x 230 -y 130
	$email = pdhainam@gmail.com
	$emailPass = Nolove1@123
	
	$randomFirstName = random -text "Anh,Thuy,Minh,Tuan,Minh Quan,Huan,Bach,Hung,Tuan,Hai,Quan,Tien,Thanh Long,Cong,Huy,Bien,Duyen,Quan,Khanh,Nam,Hai,Tai,Loc" -var "firstname"
	$randomEmail = randomEmail -name 'getVar -var firstname' -domain 'random -text "mailann.com,mailanne.com,maildes.com,maildie.com,mailerf.com,	mailerk.com,mailerl.com,maileru.com,mailhang.com,mailhoa.com,mailhong.com,mailhou.com,mailingc.com,mailjin.com,maillay.com,maillisa.com,mailmei.com,mailpain.com,mailpalm.com,mailpre.com,mailran.com,mailsai.com,mailshi.com,mailshu.com,mailtai.com,mailtang.com,mailub.com,thanhphobodoikhatmau.com,thanhphoboidoikhatmau.com"' -var "useremail"
	$randomPass = randomPassword -var userpassword
	$getPassword = getVar -name userpassword
	$getOTPMail = getVar -name "otp_mail"
	$image = var -name "imageCaptcha" -value 'getImage -startX 153 -startY 405 -endX 950 -endY 715'
	$captchaResult = readcaptcha -key "0407590008409e6e69f340089f6a4055" -image "getVar -var imageCaptcha" -timeout 100000
	
	
	//by phone
	$requestPhone = get -url "http://api.simthue.com/request/create?key=LIs9dvy-QTatYoI8tgCxHZZe2&service_id=167" -field "id" -var "id_phone"
	$gen_link_request = replace -text "http://api.simthue.com/request/check?key=LIs9dvy-QTatYoI8tgCxHZZe2&id=_id_" -replace "_id_" -to "getVar -name id_phone" -var "get_link_otp"
	$getOTP = get -url "getVar -name get_link_otp" -field sms -regex "[0-9]{6} is your Amazon" -regexPos 0 -startAt 0 -endAt 6 -var "otp"
	$setPhone = get -url "getVar -name get_link_otp" -field number -var "phone"
	$replacePhone = replace -text 'getVar -name "phone"' -replace "^84" -to "0" -var "phone"
	$getPhone = getVar -name "phone"
	
endDefine


loop -timeout 500000
	wait -text "Ok" -exactly true -timeout 300000 -thenclick true
endloop

loop -timeout 500000
	if -text "NONE OF THE ABOVE" -thenClick true -timeout 300000
endloop


sequence
	log -text "----------TASK-START---------"
	openapp -p $pk
	json -file "$pk" -field "current_status" -value "open $pk"
	$sleep
	$sleep
	$sleep
	$sleep
	$sleep

	wait -text 'Which language and currency do you want to shop in?' -exactly true -timeout 10000 -then 'wait -text "Done" -exactly true -timeout 5000 -thenClick true'
	$sleep
	$sleep
	if -text 'New to Amazon.com? Create an account' -exactly true -timeout 15000 -thenInput '' -thenClick true -then '' -else '$amazon_icon '
	
	
	log -text "----------START REGISTER---------"
	setInfo -p "$pk" -field "current_status" -value "starting register"
	wait -text 'Create an account' -exactly true -pos 0 -timeout 15000 -thenClick true
	$sleep
	$sleep
	$randomFirstName
	wait -editText "" -pos 0 -timeout 100000 -thenInput 'getVar -name "firstname"' -slowinput true
	$sleep
	$randomEmail
	wait -editText "" -pos 1 -timeout 10000 -thenInput 'getVar -name "useremail"' -slowinput true
	$sleep
	$randomPass
	wait -editText "" -pos 2 -timeout 10000 -thenInput '$getPassword' -slowinput true
	$sleep
	
	log -text getAllEditText
	log -text '$getPassword'
	
	wait -text 'Continue' -exactly true -timeout 5000 -thenInput '' -thenClick true
	$sleep
	wait -text 'Verify email' -timeout 10000 -thenClick true
	$sleep
	
	$sleep
	
	if -text 'Please solve this puzzle so we know you' -timeout 10000 -then 'setInfo -p "$pk" -field "current_status" -value "register inputing captcha"'
	$sleep
	wait -text 'Please solve this puzzle so we know you' -timeout 50000 -then {$image}
	$sleep
	$sleep
	wait -text 'Please solve this puzzle so we know you' -timeout 10000 -then {wait -editText "" -timeout 10000 -pos 0 -thenInput '$captchaResult' -slowinput true}
	$sleep
	wait -text 'Continue' -exactly true -timeout 5000 -thenClick true
	$sleep
	wait -buttontext 'Create' -timeout 10000 -thenClick true
	$sleep
	
	$sleep
	$sleep
	$sleep
	$sleep
	if -text 'email' -timeout 10000 -then 'setInfo -p "$pk" -field "current_status" -value "register inputing mail otp"'
	readMail -host imappro.zoho.com -user $email -pass $emailPass -contain "getVar -name useremail" -limit 15 -regex ">[0-9]{6}" -regexPos 1 -startAt 1 -endAt 7 -var "otp_mail"
	if -getVar "otp_mail" -equal null -then 'sleep -t 60000'
	readMail -host imappro.zoho.com -user $email -pass $emailPass -contain "getVar -name useremail" -limit 15 -regex ">[0-9]{6}" -regexPos 1 -startAt 1 -endAt 7 -var "otp_mail"
	
	
	wait -editText "" -pos 0 -timeout 20000 -theninput '$getOTPMail' -slowinput true
	$sleep
	
	wait -text 'Continue' -exactly true -timeout 5000 -thenClick true
	$sleep
	wait -text 'Verify' -exactly true -timeout 10000 -thenClick true
	$sleep
	$sleep
	
	log -text "REG READ MAIL OTP"
	
	$sleep
	if -text 'Add mobile number' -exactly true -timeout 10000 -thenInput '' -thenClick true -then '$requestPhone'
	if -text 'Add mobile number' -exactly true -timeout 10000  -then 'setInfo -p "$pk" -field "current_status" -value "register inputing mobile OTP"'
	$gen_link_request
	$setPhone
	$replacePhone
	$sleep
	$sleep
	$sleep
	$setPhone
	$replacePhone
	
	if -getVar "phone" -equal null -then 'sleep -t 30000'
	if -getVar "phone" -equal null -then '$setPhone'
	if -getVar "phone" -equal null -then 'sleep -t 30000'
	if -getVar "phone" -equal null -then '$setPhone'
	//sleep -t 20000
	
	$replacePhone
	$sleep
	wait -editText "" -pos 0 -thenInput '$getPhone' -slowinput true
	$sleep
	wait -text 'US +1' -exactly true -timeout 10000 -thenInput '' -thenClick true
	$sleep
	wait -text '+84' -timeout 10000 -thenScrollTo true
	$sleep
	wait -text '+84' -timeout 10000 -thenClick true
	$sleep
	log -text getAllEditText
	wait -buttontext 'Add mobile number' -timeout 10000 -thenClick true
	$sleep
	$sleep
	wait -text "I'll enter the code myself" -timeout 10000 -thenClick true
	$sleep
	$getOTP
	$sleep
	$sleep
	$sleep
	$sleep
	if -getVar "otp" -equal null -then 'sleep -t 30000'
	
	if -getVar "otp" -equal null -then '$getOTP'
	
	if -getVar "otp" -equal null -then 'sleep -t 60000'
	
	if -getVar "otp" -equal null -then '$getOTP'
	
	if -getVar "otp" -equal null -then 'sleep -t 60000'
	//sleep -t 55000
	$getOTP
	
	wait -editText "" -pos 0 -timeout 20000 -theninput 'getVar -name otp' -slowinput true
	$sleep
	wait -text 'Verify' -exactly true -timeout 10000 -thenInput '' -thenClick true
	$sleep
	
	wait -buttontext 'Create' -timeout 10000 -thenClick true
	$sleep
	$sleep
	$sleep
	$sleep
	
	if -text 'What are you looking for?' -timeout 10000 -then {setInfo -p "$pk" -field "register_date" -value 'getCurrentTime -format "dd-MM-yyyy hh:mm"'}
	if -text 'What are you looking for?' -timeout 10000 -then 'setInfo -p "$pk" -field "loged_name" -value "getVar -name firstname"'
	if -text 'What are you looking for?' -timeout 10000 -then 'setInfo -p "$pk" -field "loged_user" -value "getVar -name useremail"'
	if -text 'What are you looking for?' -timeout 10000 -then 'setInfo -p "$pk" -field "loged_password" -value "$getPassword"'
	
	if -buttontext 'Add mobile number' -timeout 5000 -then 'log -text "REG ERROR CAN NOT RECEIVE SIM OTP"'
	if -text 'Please solve this puzzle so we know you' -timeout 5000 -then 'log -text "REG ERROR CAN NOT READ CAPTCHA"'
	if -text 'mobile' -timeout 5000 -else 'setInfo -p "$pk" -field "current_status" -value "register success"'
	
	
	home
	log -text "----------TASK-DONE---------"

endSequence
